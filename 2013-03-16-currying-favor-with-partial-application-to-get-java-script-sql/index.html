<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="twitter:card" content="summary" /><title>Currying Favor with Partial Application to get JavaScript SQL | походы на моем столе</title>
<meta name="description" content="There is a domain that attends to curry as one of the quintessential elements of regional cuisine. This is not that...">

<!-- SEO and meta information for twitter/whatsupp cards --><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Currying Favor with Partial Application to get JavaScript SQL | походы на моем столе</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Currying Favor with Partial Application to get JavaScript SQL" />
<meta name="author" content="CF" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="There is a domain that attends to curry as one of the quintessential elements of regional cuisine. This is not that…" />
<meta property="og:description" content="There is a domain that attends to curry as one of the quintessential elements of regional cuisine. This is not that…" />
<link rel="canonical" href="https://luddites.me/2013-03-16-currying-favor-with-partial-application-to-get-java-script-sql/" />
<meta property="og:url" content="https://luddites.me/2013-03-16-currying-favor-with-partial-application-to-get-java-script-sql/" />
<meta property="og:site_name" content="походы на моем столе" />
<meta property="og:image" content="https://luddites.me/images/2013-03-16-currying-favor-with-partial-application-to-get-java-script-sql.jpeg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2013-03-16T00:00:00-05:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://luddites.me/images/2013-03-16-currying-favor-with-partial-application-to-get-java-script-sql.jpeg" />
<meta property="twitter:title" content="Currying Favor with Partial Application to get JavaScript SQL" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"CF"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://luddites.me/images/logo.png"},"name":"CF"},"description":"There is a domain that attends to curry as one of the quintessential elements of regional cuisine. This is not that…","@type":"BlogPosting","image":"https://luddites.me/images/2013-03-16-currying-favor-with-partial-application-to-get-java-script-sql.jpeg","url":"https://luddites.me/2013-03-16-currying-favor-with-partial-application-to-get-java-script-sql/","dateModified":"2013-03-16T00:00:00-05:00","datePublished":"2013-03-16T00:00:00-05:00","headline":"Currying Favor with Partial Application to get JavaScript SQL","mainEntityOfPage":{"@type":"WebPage","@id":"https://luddites.me/2013-03-16-currying-favor-with-partial-application-to-get-java-script-sql/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<!-- Feed --><link type="application/atom+xml" rel="alternate" href="https://luddites.me/atom.xml" title="походы на моем столе" /><!-- CSS --><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="https://luddites.me/assets/css/main.css" />
<noscript><link rel="stylesheet" href="https://luddites.me/assets/css/noscript.css" /></noscript>
<link rel="stylesheet" href="https://luddites.me/assets/stylesheets/main.css" />
<link rel="stylesheet" href="https://luddites.me/assets/css/academicons.min.css"/>

<!-- Analytics --><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','G-NZGZJTW03Q','auto');ga('require','displayfeatures');ga('send','pageview');</script>

<script type="application/json" class="js-hypothesis-config">
  {
    "openSidebar": false
  }
</script>
<script async src="https://hypothes.is/embed.js"></script>


<!-- Math -->


  </head>
  <body class="is-loading">

    <!-- Wrapper -->
      <div id="wrapper" class="fade-in">

        <!-- Header -->
        <header id="header">
          <a title="Hiking My Desk" href="https://luddites.me/" class="logo">походы на моем столе</a>
        </header>

        <!-- Nav -->
          <nav id="nav">

            <ul class="links">
  <li class=""><a href="https://luddites.me/">Home</a></li>
  <li class=""><a href="https://luddites.me/categories/">Categories</a></li>
  <li class=""><a href="https://luddites.me/about/">обо мне</a></li>
</ul>

<ul class="icons">
  <li class=""><a href="https://luddites.me/search" class="icon fa-search"><span class="label">Search</span></a></li>
  <li><a href="https://github.com/crfroehlich" class="icon fa-github" rel="nofollow"><span class="label">GitHub</span></a></li>
  <li><a href="https://twitter.com/tquestingbeast" class="icon fa-twitter" rel="nofollow"><span class="label">Twitter</span></a></li>
  <li>
    
      <a href="/atom.xml" title="Atom Feed" class="icon fa-rss">
        <span class="label">Subscribe</span>
      </a>
    
  </li>
</ul>


          </nav>

        <!-- Main -->
        <div id="main">

          <!-- Post -->
          <section class="post">
            
            <p><article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Currying Favor with Partial Application to get JavaScript SQL</h1>
    
    <p class="post-meta post-meta-title"><time class="dt-published" datetime="2013-03-16T00:00:00-05:00" itemprop="datePublished">
        Mar 16, 2013
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">CF</span></span>• 



<span class="read-time" title="Estimated read time">

  4 min read

</span>

    </p>

    
    <section>  
    <p class="category-tags"><i class="fa fa-folder category-tags-icon"></i></i>
      
        <a class="category-tags-link" href="/categories/#code">code</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#curry">curry</a>
        
      
      </p>
      </section>
    

    

    </header>
  <br>
  <div class="post-content e-content" itemprop="articleBody">
    <p>There is a domain that attends to curry as one of the quintessential elements of regional cuisine. This is not that domain; though in this domain I would argue we need a paprika.</p>

<p>If the terms <em>curry</em> or <em>partial application</em> are at all unfamiliar to you, I highly recommend Reg Braithwaite’s <a href="http://raganwald.com/2013/03/07/currying-and-partial-application.html">latest opus on the subject</a>. Lending support are <a href="http://plus.google.com/112487099551149077731">+Ben Alman</a> with his own <a href="http://benalman.com/news/2012/09/partial-application-in-javascript/">eviscerating tour de force</a> as well as <a href="http://plus.google.com/110516491705475800224">+Axel Rauschmayer</a> with his <a href="http://www.2ality.com/2011/09/currying-vs-part-eval.html">very, extremely, routinely reputable entry</a>. If you’ve ever followed me here before, you may remember a fog surrounding an idea that touched on partial application from <a href="http://hiking.luddites.me/2013/01/good-reads.html">Good Reads</a>, where I linked to (again to Mr. Braithwaite) <a href="https://github.com/raganwald/homoiconic/blob/master/2013/01/practical-applications-of-partial-application.md">the skinny</a>.</p>

<p>Do not be confused, dismayed, disheartened or discouraged. Currying and partial application are not easy-to-grok. The literature on the subject, while vast, is dense. Even in the most skilled hands, attempts to bring these tomes down from Mt. Sinai, have not routinely resulted in greater clarity.</p>

<p>But this is not yet-another-indoctrination on the subject. Defer to the authorities above for that. Here, I’m attempting  to exploit the potential for good. Using both ingredients, it is possible to create a semantic for querying JavaScript objects in a syntax that resembles SQL. Are there other solutions to do this? <a href="https://plus.google.com/108988276571177665337/posts/ahm5G625Vix">Yes</a>.</p>

<p>Once you’ve apprehended grokation of the concepts, it should be straightforward to see the implementation of a few partial application standard methods: <a href="http://en.wikipedia.org/wiki/Map_(higher-order_function)">map</a>, <a href="http://en.wikipedia.org/wiki/Filter_(higher-order_function)">filter</a> and <a href="http://en.wikipedia.org/wiki/Fold_(higher-order_function)">fold</a>. Lots of libraries have already done the diligence and written these for us but for the sake of having something to write, let’s implement them again (In the real world, you’re better off taking what <a href="http://osteele.com/sources/javascript/functional/">functional js</a> or <a href="http://fitzgen.github.com/wu.js">wu.js</a> have already built)!</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">curryLeft</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span>    
  <span class="kd">var</span> <span class="nx">slice</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">;</span>    
  <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>    
  <span class="k">return</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>    
    <span class="k">return</span> <span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">)));</span>    
  <span class="p">};</span>    
<span class="p">}</span>    
    
<span class="kd">function</span> <span class="nx">foldLeft</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">newArray</span><span class="p">,</span> <span class="nx">oldArray</span><span class="p">)</span> <span class="p">{</span>    
  <span class="kd">var</span> <span class="nx">accumulation</span> <span class="o">=</span> <span class="nx">newArray</span><span class="p">;</span>    
  <span class="nx">each</span><span class="p">(</span><span class="nx">oldArray</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>    
    <span class="nx">accumulation</span> <span class="o">=</span> <span class="nx">func</span><span class="p">(</span><span class="nx">accumulation</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>    
  <span class="p">});</span>    
  <span class="k">return</span> <span class="nx">accumulation</span><span class="p">;</span>    
<span class="p">}</span>    
    
<span class="kd">function</span> <span class="nx">map</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">array</span><span class="p">)</span> <span class="p">{</span>    
  <span class="kd">var</span> <span class="nx">onIteration</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">accumulation</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>    
    <span class="k">return</span> <span class="nx">accumulation</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">func</span><span class="p">(</span><span class="nx">val</span><span class="p">));</span>    
  <span class="p">};</span>    
  <span class="k">return</span> <span class="nx">foldLeft</span><span class="p">(</span><span class="nx">onIteration</span><span class="p">,</span> <span class="err">\</span><span class="p">[</span><span class="err">\</span><span class="p">],</span> <span class="nx">array</span><span class="p">);</span>    
<span class="p">}</span>    
    
<span class="kd">function</span> <span class="nx">filter</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">array</span><span class="p">)</span> <span class="p">{</span>    
  <span class="kd">var</span> <span class="nx">onIteration</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">accumulation</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>    
    <span class="k">if</span> <span class="p">(</span><span class="nx">func</span><span class="p">(</span><span class="nx">val</span><span class="p">))</span> <span class="p">{</span>    
      <span class="k">return</span> <span class="nx">accumulation</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>    
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>    
      <span class="k">return</span> <span class="nx">accumulation</span><span class="p">;</span>    
    <span class="p">}</span>    
  <span class="p">};</span>    
  <span class="k">return</span> <span class="nx">foldLeft</span><span class="p">(</span><span class="nx">onIteration</span><span class="p">,</span> <span class="err">\</span><span class="p">[</span><span class="err">\</span><span class="p">],</span> <span class="nx">array</span><span class="p">);</span>    
<span class="p">}</span>    
</code></pre></div></div>

<p>With just these, we can do something that’s almost cool. We can extend the native Array class to add some new methods:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperties</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span>    
  <span class="na">_where</span><span class="p">:</span> <span class="p">{</span>    
    <span class="na">value</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span>    
      <span class="k">return</span> <span class="nx">filter</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>    
    <span class="p">},</span>    
  <span class="p">},</span>    
  <span class="na">_select</span><span class="p">:</span> <span class="p">{</span>    
    <span class="na">value</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span>    
      <span class="k">return</span> <span class="nx">map</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>    
    <span class="p">},</span>    
  <span class="p">},</span>    
<span class="p">});</span>    
</code></pre></div></div>

<p>At this point, given an instance of an Array (thanks to <a href="https://github.com/marak/Faker.js/">Faker</a>), like:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">somePeople</span> <span class="o">=</span> <span class="err">\</span><span class="p">[</span>    
    <span class="p">{</span><span class="dl">"</span><span class="s2">FirstName</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">Cristina</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">LastName</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">Quigley</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">PhoneNumber</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">1-189-868-2830</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Email</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">Imelda@lourdes.ca</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Id</span><span class="dl">"</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span>    
    <span class="p">{</span><span class="dl">"</span><span class="s2">FirstName</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">Eriberto</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">LastName</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">Bailey</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">PhoneNumber</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">1-749-549-2050 x36612</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Email</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">Pamela</span><span class="se">\</span><span class="s2">_Gaylord@ludie.net</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Id</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>    
    <span class="p">{</span><span class="dl">"</span><span class="s2">FirstName</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">Amina</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">LastName</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">Schaden</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">PhoneNumber</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">463-301-9579 x9511</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Email</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">Conner</span><span class="se">\</span><span class="s2">_Gusikowski@jolie.tv</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Id</span><span class="dl">"</span><span class="p">:</span><span class="mi">2</span><span class="p">}</span><span class="err">\</span><span class="p">];</span>    
</code></pre></div></div>

<p>If we wanted to select the FirstName of each record, we could do something crude like:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">somePeople</span><span class="p">.</span><span class="err">\</span><span class="nx">_select</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">row</span><span class="p">)</span> <span class="p">{</span>    
  <span class="k">return</span> <span class="nx">row</span><span class="p">.</span><span class="nx">FirstName</span><span class="p">;</span>    
<span class="p">});</span>    
</code></pre></div></div>

<p>But this is still too obtuse. With a little curry, we can make it better. We used partial application to get to ‘_select’, but we can switch gears to curry to get a better query mechanism. First, let’s define a query method: <em>Update: we technically don’t need curry here, as we’re not abstracting the ‘query’ object as a parameter. Thanks to Thomas Burette in the comments</em>.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">array</span><span class="p">)</span> <span class="p">{</span>    
  <span class="kd">var</span> <span class="nx">tables</span> <span class="o">=</span> <span class="err">\</span><span class="p">[</span><span class="err">\</span><span class="p">];</span>    
  <span class="nx">tables</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">array</span><span class="p">);</span>    
  <span class="kd">var</span> <span class="err">\</span><span class="nx">_query</span> <span class="o">=</span> <span class="p">{</span>    
    <span class="na">tables</span><span class="p">:</span> <span class="nx">tables</span><span class="p">,</span>    
    <span class="na">from</span><span class="p">:</span> <span class="k">from</span><span class="p">,</span>    
    <span class="na">select</span><span class="p">:</span> <span class="nx">select</span><span class="p">,</span>    
    <span class="na">run</span><span class="p">:</span> <span class="nx">run</span><span class="p">,</span>    
  <span class="p">};</span>    
  <span class="k">return</span> <span class="err">\</span><span class="nx">_query</span><span class="p">;</span>    
<span class="p">};</span>    
</code></pre></div></div>

<p>select and from methods are straightforward:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">select</span><span class="p">()</span> <span class="p">{</span>    
  <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>    
    
  <span class="kd">var</span> <span class="nx">slice</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">;</span>    
  <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>    
  <span class="nx">query</span><span class="p">.</span><span class="nx">columns</span> <span class="o">=</span> <span class="nx">query</span><span class="p">.</span><span class="nx">columns</span> <span class="o">||</span> <span class="err">\</span><span class="p">[</span><span class="err">\</span><span class="p">];</span>    
  <span class="nx">each</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">argumentValue</span><span class="p">)</span> <span class="p">{</span>    
    <span class="nx">query</span><span class="p">.</span><span class="nx">columns</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">argumentValue</span><span class="p">);</span>    
  <span class="p">});</span>    
  <span class="k">return</span> <span class="nx">query</span><span class="p">;</span>    
<span class="p">}</span>    
    
<span class="kd">function</span> <span class="k">from</span><span class="p">(</span><span class="nx">array</span><span class="p">)</span> <span class="p">{</span>    
  <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>    
  <span class="nx">query</span><span class="p">.</span><span class="nx">tables</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">array</span><span class="p">);</span>    
  <span class="k">return</span> <span class="nx">query</span><span class="p">;</span>    
<span class="p">}</span>    
</code></pre></div></div>

<p>which then only leaves execution. I’ve deliberately not optimized this method for the purpose of illustration: in the absence of the tools, this is what such code looks like. Look at the redundancy and duplication. Marvel at the inelegance. <a href="http://prog21.dadgum.com/169.html">Appreciate the fact that it works</a>.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">run</span><span class="p">()</span> <span class="p">{</span>    
    <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>    
    <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="err">\</span><span class="p">[</span><span class="err">\</span><span class="p">];</span>    
    <span class="k">if</span> <span class="p">(</span><span class="nx">query</span><span class="p">.</span><span class="nx">columns</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>    
        <span class="kd">var</span> <span class="nx">results</span> <span class="o">=</span> <span class="err">\</span><span class="p">[</span><span class="err">\</span><span class="p">];</span>    
        <span class="nx">each</span><span class="p">(</span><span class="nx">query</span><span class="p">.</span><span class="nx">columns</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">columnName</span><span class="p">)</span> <span class="p">{</span>    
    
            <span class="nx">each</span><span class="p">(</span><span class="nx">query</span><span class="p">.</span><span class="nx">tables</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tbl</span><span class="p">)</span> <span class="p">{</span>    
                <span class="k">if</span> <span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">tbl</span><span class="p">))</span> <span class="p">{</span>    
                    <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="p">{};</span>    
                    <span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">tbl</span><span class="p">.</span><span class="err">\</span><span class="nx">_select</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>    
                        <span class="k">return</span> <span class="nx">val</span><span class="err">\</span><span class="p">[</span><span class="nx">columnName</span><span class="err">\</span><span class="p">];</span>    
                    <span class="p">});</span>    
                    <span class="k">if</span> <span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>    
                        <span class="nx">res</span><span class="err">\</span><span class="p">[</span><span class="nx">columnName</span><span class="err">\</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>    
                        <span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>    
                    <span class="p">}</span>    
                <span class="p">}</span>    
            <span class="p">},</span> <span class="kc">true</span><span class="p">);</span>    
    
        <span class="p">});</span>    
    
        <span class="kd">var</span> <span class="nx">returnRows</span> <span class="o">=</span> <span class="err">\</span><span class="p">[</span><span class="err">\</span><span class="p">];</span>    
        <span class="k">if</span><span class="p">(</span><span class="nx">results</span> <span class="o">&amp;&amp;</span> <span class="nx">results</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>    
            <span class="kd">var</span> <span class="nx">firstResult</span> <span class="o">=</span> <span class="nx">results</span><span class="err">\</span><span class="p">[</span><span class="mi">0</span><span class="err">\</span><span class="p">];</span>    
    
            <span class="nx">each</span><span class="p">(</span><span class="nx">firstResult</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>    
    
                <span class="nx">each</span><span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cell</span><span class="p">){</span>    
                    <span class="kd">var</span> <span class="nx">row</span> <span class="o">=</span> <span class="p">{};</span>    
                    <span class="nx">row</span><span class="err">\</span><span class="p">[</span><span class="nx">key</span><span class="err">\</span><span class="p">]</span> <span class="o">=</span> <span class="nx">cell</span><span class="p">;</span>    
                    <span class="nx">each</span><span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>    
                        <span class="nx">each</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span><span class="nx">k</span><span class="p">){</span>    
                            <span class="nx">each</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>    
                                <span class="nx">row</span><span class="err">\</span><span class="p">[</span><span class="nx">k</span><span class="err">\</span><span class="p">]</span> <span class="o">=</span> <span class="nx">c</span><span class="p">;</span>    
                            <span class="p">})</span>    
                        <span class="p">},</span><span class="kc">true</span><span class="p">)</span>    
                    <span class="p">},</span><span class="kc">true</span><span class="p">)</span>    
                    <span class="nx">returnRows</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">row</span><span class="p">);</span>    
                <span class="p">},</span><span class="kc">true</span><span class="p">);</span>    
    
            <span class="p">},</span><span class="kc">true</span><span class="p">)</span>    
    
        <span class="p">}</span>    
    
    <span class="p">}</span>    
    <span class="k">return</span> <span class="nx">returnRows</span><span class="p">;</span>    
<span class="p">}</span>    
</code></pre></div></div>

<p>Now, this yields a syntax which looks a lot more like SQL:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">newQuery</span> <span class="o">=</span> <span class="nx">query</span><span class="p">(</span><span class="nx">people</span><span class="p">).</span><span class="nx">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">FirstName</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">LastName</span><span class="dl">'</span><span class="p">);</span>    
<span class="kd">var</span> <span class="nx">results</span> <span class="o">=</span> <span class="nx">newQuery</span><span class="p">.</span><span class="nx">run</span><span class="p">();</span>    
</code></pre></div></div>

<p>From here, ‘where’, ‘join’ (yes I said JOIN), ‘orderby’ and ‘groupby’ are all implementation details. This is just a proof-of-concept post, but given some large Faker data sets it already works quite well given its limitations. Refactoring ‘run’ into a method which utilizes partial application will yield mountains.</p>

<p>As always, everything I blog and code is public domain. You can view the source from the <a href="https://github.com/somecallmechief/oj-sql">oj-sql project here</a>, collab with me on <a href="https://c9.io/somecallmechief/oj-sql">c9 here</a>, or do whatever strikes your whim. May the wind that strikes your whim be always at your back.</p>

  </div>
  <a class="u-url" href="/2013-03-16-currying-favor-with-partial-application-to-get-java-script-sql/" hidden></a>
</article>
</p>
          </section>

          <!-- Footer -->
            <footer>
              <ul class="actions">
                <li><a href="#header" title="Back to Top" class="button">Наверх</a></li>
              </ul>
              <div class="PageNavigation">
                  
                    <a class="prev" href="/2013-01-31-the-greatest-heist-ever-conceived/">&laquo; The Greatest Heist Ever Conceived</a>
                  
                  
                    <a class="next" href="/2013-03-17-revisiting-how-to-subclass-an-array-really/">Revisiting: How to Subclass an Array (Really) &raquo;</a>
                  
              </div>
            </footer>
          </div>
        
         

        <!-- Footer -->
        <!-- Copyright -->
<div id="copyright">
  <ul>
    <li>
      <a href="https://github.com/crfroehlich" class="icon fa-github" rel="nofollow"><span class="label">GitHub</span></a> |
      <a href="https://twitter.com/tquestingbeast" class="icon fa-twitter" rel="nofollow"><span class="label">Twitter</span></a> |
      <a href="https://orcid.org/0000-0001-6652-5940" class="ai ai-orcid" rel="nofollow"><span class="label">ORCID</span></a> |
      <a href="https://scholar.google.es/citations?user=j3---DAAAAAJ" class="ai ai-google-scholar" rel="nofollow"><span class="label">Google Scholar</span></a> |
      
      <a href="/atom.xml" title="Atom Feed" class="icon fa-rss" rel="nofollow">
        <span class="label">Subscribe</span>
      </a>
      
    </li>
    <li>Powered by <a href="https://fastpages.fast.ai/">fastpages</a></li>
    <li>Design by <a href="https://html5up.net" rel="nofollow">HTML5 UP</a> &
      <a href="https://github.com/mmistakes/jekyll-theme-basically-basic">Basically Basic</a></li>
    <li>Jekyll Integration by <a href="https://jekyllup.com/">JekyllUp</a> </li>
    <li>Please take generously</li>
  </ul>
</div>


      </div>

    <!-- Scripts -->
    <!-- DYN -->
<script src="https://luddites.me/assets/js/jquery.min.js"></script>
<script src="https://luddites.me/assets/js/jquery.scrollex.min.js"></script>
<script src="https://luddites.me/assets/js/jquery.scrolly.min.js"></script>
<script src="https://luddites.me/assets/js/skel.min.js"></script>
<script src="https://luddites.me/assets/js/util.js"></script>
<script src="https://luddites.me/assets/js/main.js"></script>


  </body>
</html>
