<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="twitter:card" content="summary" /><title>Currying Favor with Partial Application to get JavaScript SQL | ЛУДДИТЫ, INC.</title>
<meta name="description" content="Editor’s Note This is an old post from March of 2013 from an old blog Apparently it still gets enoug...">

<!-- SEO and meta information for twitter/whatsupp cards --><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Currying Favor with Partial Application to get JavaScript SQL | ЛУДДИТЫ, INC.</title>
<meta name="generator" content="Jekyll v4.0.1" />
<meta property="og:title" content="Currying Favor with Partial Application to get JavaScript SQL" />
<meta name="author" content="CF" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Editor’s Note This is an old post from March of 2013 from an old blog Apparently it still gets enoug…" />
<meta property="og:description" content="Editor’s Note This is an old post from March of 2013 from an old blog Apparently it still gets enoug…" />
<link rel="canonical" href="https://luddites.me/cellar/currying/code/partial/application/2017/02/04/currying-favor-with-partial-application-to-get-java-script-sql.html" />
<meta property="og:url" content="https://luddites.me/cellar/currying/code/partial/application/2017/02/04/currying-favor-with-partial-application-to-get-java-script-sql.html" />
<meta property="og:site_name" content="ЛУДДИТЫ, INC." />
<meta property="og:image" content="https://luddites.me/cellar/images/2017-02-04-currying-favor-with-partial-application-to-get-java-script-sql.jpeg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-02-04T00:00:00-06:00" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"CF"},"datePublished":"2017-02-04T00:00:00-06:00","headline":"Currying Favor with Partial Application to get JavaScript SQL","mainEntityOfPage":{"@type":"WebPage","@id":"https://luddites.me/cellar/currying/code/partial/application/2017/02/04/currying-favor-with-partial-application-to-get-java-script-sql.html"},"image":"https://luddites.me/cellar/images/2017-02-04-currying-favor-with-partial-application-to-get-java-script-sql.jpeg","description":"Editor’s Note This is an old post from March of 2013 from an old blog Apparently it still gets enoug…","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://luddites.me/cellar/images/logo.png"},"name":"CF"},"@type":"BlogPosting","url":"https://luddites.me/cellar/currying/code/partial/application/2017/02/04/currying-favor-with-partial-application-to-get-java-script-sql.html","dateModified":"2017-02-04T00:00:00-06:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<!-- Feed --><link type="application/atom+xml" rel="alternate" href="https://luddites.me/cellar/atom.xml" title="ЛУДДИТЫ, INC." /><!-- CSS --><link rel="shortcut icon" type="image/x-icon" href="/cellar/images/favicon.ico"><link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="https://luddites.me/cellar/assets/css/main.css" />
<noscript><link rel="stylesheet" href="https://luddites.me/cellar/assets/css/noscript.css" /></noscript>
<link rel="stylesheet" href="https://luddites.me/cellar/assets/stylesheets/main.css" />
<link rel="stylesheet" href="https://luddites.me/cellar/assets/css/academicons.min.css"/>

<!-- Analytics --><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','G-WZTYEG3VZJ','auto');ga('require','displayfeatures');ga('send','pageview');</script>

<!-- Math -->


  </head>
  <body class="is-loading">

    <!-- Wrapper -->
      <div id="wrapper" class="fade-in">

        <!-- Header -->
        <header id="header">
          <a href="https://luddites.me/cellar/" class="logo">ЛУДДИТЫ, INC.</a>
        </header>

        <!-- Nav -->
          <nav id="nav">

            <ul class="links">
  <li class=""><a href="https://luddites.me/cellar/">Home</a></li>
  <li class=""><a href="https://luddites.me/cellar/blog/">Blog</a></li>
  <li class=""><a href="https://luddites.me/cellar/tags/">Tags</a></li>
  <li class=""><a href="https://luddites.me/cellar/categories/">Categories</a></li>
  <li class=""><a href="https://luddites.me/cellar/about/">About me</a></li>
</ul>

<ul class="icons">
  <li class=""><a href="https://luddites.me/cellar/search" class="icon fa-search"><span class="label">Search</span></a></li>
  <li><a href="https://github.com/crfroehlich" class="icon fa-github" rel="nofollow"><span class="label">GitHub</span></a></li>
  <li><a href="https://twitter.com/tquestingbeast" class="icon fa-twitter" rel="nofollow"><span class="label">Twitter</span></a></li>
  <li>
    
      <a href="/cellar/atom.xml" title="Atom Feed" class="icon fa-rss">
        <span class="label">Subscribe</span>
      </a>
    
  </li>
</ul>


          </nav>

        <!-- Main -->
        <div id="main">

          <!-- Post -->
          <section class="post">
            
            <p><article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Currying Favor with Partial Application to get JavaScript SQL</h1><p class="page-description">Editor’s Note This is an old post from March of 2013 from an old blog Apparently it still gets enoug...</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2017-02-04T00:00:00-06:00" itemprop="datePublished">
        Feb 4, 2017
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">CF</span></span>• 



<span class="read-time" title="Estimated read time">

  4 min read

</span>

    </p>

    
      <p class="category-tags"><i class="fa fa-folder category-tags-icon"></i></i>
      
        <a class="category-tags-link" href="/cellar/categories/#currying">currying</a>
        &nbsp;
      
        <a class="category-tags-link" href="/cellar/categories/#code">code</a>
        &nbsp;
      
        <a class="category-tags-link" href="/cellar/categories/#partial">partial</a>
        &nbsp;
      
        <a class="category-tags-link" href="/cellar/categories/#application">application</a>
        
      
      </p>
    

    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
</ul><p><em>Editor’s Note: This is an old post from March of 2013, from an old blog. Apparently it still gets enough hits to need updating as links have changed. Re-posting it here with URL corrections.</em></p>

<p>There is a domain that attends to curry as one of the quintessential elements of regional cuisine. This is not that domain; though in this domain I would argue we need a paprika.</p>

<p>If the terms <em>curry</em> or <em>partial application</em> are at all unfamiliar to you, I highly recommend Reg Braithwaite’s <a href="http://raganwald.com/2013/03/07/currying-and-partial-application.html">latest opus on the subject</a>. Lending support are <a href="http://plus.google.com/112487099551149077731">+Ben Alman</a> with his own <a href="http://benalman.com/news/2012/09/partial-application-in-javascript/">eviscerating tour de force</a> as well as <a href="http://plus.google.com/110516491705475800224">+Axel Rauschmayer</a> with his <a href="http://www.2ality.com/2011/09/currying-vs-part-eval.html">very, extremely, routinely reputable entry</a>. If you’ve ever followed me here before, you may remember a fog surrounding an idea that touched on partial application from <a href="http://hiking.luddites.me/2013/01/good-reads.html">Good Reads</a>, where I linked to (again to Mr. Braithwaite) <a href="https://github.com/raganwald/homoiconic/blob/master/2013/01/practical-applications-of-partial-application.md">the skinny</a>.</p>

<p>Do not be confused, dismayed, disheartened or discouraged. Currying and partial application are not easy-to-grok. The literature on the subject, while vast, is dense. Even in the most skilled hands, attempts to bring these tomes down from Mt. Sinai, have not routinely resulted in greater clarity.</p>

<p>But this is not yet-another-indoctrination on the subject. Defer to the authorities above for that. Here, I’m attempting to exploit the potential for good. Using both ingredients, it is possible to create a semantic for querying JavaScript objects in a syntax that resembles SQL. Are there other solutions to do this? <a href="https://plus.google.com/108988276571177665337/posts/ahm5G625Vix">Yes</a>.</p>

<p>Once you’ve apprehended grokation of the concepts, it should be straightforward to see the implementation of a few partial application standard methods: <a href="http://en.wikipedia.org/wiki/Map_%28higher-order_function%29">map</a>, <a href="http://en.wikipedia.org/wiki/Filter_%28higher-order_function%29">filter</a> and <a href="http://en.wikipedia.org/wiki/Fold_%28higher-order_function%29">fold</a>. Lots of libraries have already done the diligence and written these for us but for the sake of having something to write, let’s implement them again (In the real world, you’re better off taking what <a href="http://wiht.link/FunctionalJS">functional js</a> or <a href="http://fitzgen.github.com/wu.js">wu.js</a> have already built)!</p>

<p>function curryLeft(func) {  <br>
var slice = Array.prototype.slice;  <br>
var args = slice.call(arguments, 1);  <br>
return function() {  <br>
return func.apply(this, args.concat(slice.call(arguments, 0)));</p>

<p>}  <br>
}</p>

<p>function foldLeft(func,newArray,oldArray) {  <br>
var accumulation = newArray;  <br>
each(oldArray, function(val) {  <br>
accumulation = func(accumulation, val);  <br>
});  <br>
return accumulation;</p>

<p>}</p>

<p>function map(func, array) {  <br>
var onIteration = function(accumulation, val) {  <br>
return accumulation.concat(func(val));  <br>
};  <br>
return foldLeft(onIteration, [], array)  <br>
}</p>

<p>function filter(func, array) {  <br>
var onIteration = function(accumulation, val) {  <br>
if(func(val)) {  <br>
return accumulation.concat(val);  <br>
} else {  <br>
return accumulation;  <br>
}  <br>
};  <br>
return foldLeft(onIteration, [], array)  <br>
}</p>

<p>With just these, we can do something that’s almost cool. We can extend the native Array class to add some new methods:</p>

<p>Object.defineProperties(Array.prototype, {  <br>
‘_where’: {  <br>
value: function(func) {  <br>
return filter(func, this);  <br>
}  <br>
},  <br>
‘_select’: {  <br>
value: function(func) {  <br>
return map(func, this);  <br>
}  <br>
}  <br>
});</p>

<p>At this point, given an instance of an Array (thanks to <a href="https://github.com/marak/Faker.js/">Faker</a>), like:</p>

<p>var somePeople = [  <br>
{“FirstName”:”Cristina”, “LastName”:”Quigley”, “PhoneNumber”:”1-189-868-2830”, “Email”:”Imelda@lourdes.ca”, “Id”:0},  <br>
{“FirstName”:”Eriberto”, “LastName”:”Bailey”, “PhoneNumber”:”1-749-549-2050 x36612”, “Email”:”Pamela_Gaylord@ludie.net”, “Id”:1},  <br>
{“FirstName”:”Amina”, “LastName”:”Schaden”, “PhoneNumber”:”463-301-9579 x9511”, “Email”:”Conner_Gusikowski@jolie.tv”, “Id”:2}];</p>

<p>If we wanted to select the FirstName of each record, we could do something crude like:</p>

<p>somePeople._select(function(row) { return row.FirstName });</p>

<p>But this is still too obtuse. With a little curry, we can make it better. We used partial application to get to ‘_select’, but we can switch gears to curry to get a better query mechanism. First, let’s define a query method: <em>Update: we technically don’t need curry here, as we’re not abstracting the ‘query’ object as a parameter. Thanks to Thomas Burette in the comments</em>.</p>

<p>var query = function(array) {  <br>
var tables = [];  <br>
tables.push(array);  <br>
var _query = {  <br>
tables: tables,  <br>
from: from,  <br>
select: select,  <br>
run: run  <br>
};  <br>
return _query;  <br>
};</p>

<p>select and from methods are straightforward:</p>

<p>function select() {  <br>
var query = this;</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var slice = Array.prototype.slice;    
var args = slice.call(arguments, 0);    
query.columns = query.columns || \[\];    
each(args, function(argumentValue) {    
    query.columns.push(argumentValue);    
});    
return query;    
</code></pre></div></div>

<p>}</p>

<p>function from(array) {  <br>
var query = this;  <br>
query.tables.push(array);  <br>
return query;  <br>
}</p>

<p>which then only leaves execution. I’ve deliberately not optimized this method for the purpose of illustration: in the absence of the tools, this is what such code looks like. Look at the redundancy and duplication. Marvel at the inelegance. <a href="http://prog21.dadgum.com/169.html">Appreciate the fact that it works</a>.</p>

<p>function run() {  <br>
var query = this;  <br>
var ret = [];  <br>
if (query.columns.length &gt; 0) {  <br>
var results = [];  <br>
each(query.columns, function(columnName) {</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        each(query.tables, function(tbl) {    
            if (Array.isArray(tbl)) {    
                var res = {};    
                var val = tbl.\_select(function(val) {    
                    return val\[columnName\];    
                });    
                if (val) {    
                    res\[columnName\] = val;    
                    results.push(res);    
                }    
            }    
        }, true);    

    });    

    var returnRows = \[\];    
    if(results &amp;&amp; results.length &gt; 0) {    
        var firstResult = results\[0\];    

        each(firstResult, function(val, key) {    

            each(val, function(cell){    
                var row = {};    
                row\[key\] = cell;    
                each(results.slice(1), function(result) {    
                    each(result, function(v,k){    
                        each(v, function(c) {    
                            row\[k\] = c;    
                        })    
                    },true)    
                },true)    
                returnRows.push(row);    
            },true);    

        },true)    

    }    

}    
return returnRows;    
</code></pre></div></div>

<p>}</p>

<p>Now, this yields a syntax which looks a lot more like SQL:</p>

<p>var newQuery = query(people).select(‘FirstName’, ‘LastName’);  <br>
var results = newQuery.run();</p>

<p>From here, ‘where’, ‘join’ (yes I said JOIN), ‘orderby’ and ‘groupby’ are all implementation details. This is just a proof-of-concept post, but given some large Faker data sets it already works quite well given its limitations. Refactoring ‘run’ into a method which utilizes partial application will yield mountains.</p>

<p>As always, everything I blog and code is public domain. You can view the source from the <a href="https://github.com/somecallmechief/oj-sql">oj-sql project here</a>, collab with me on <a href="https://c9.io/somecallmechief/oj-sql">c9 here</a>, or do whatever strikes your whim. May the wind that strikes your whim be always at your back.</p>

  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="crfroehlich/cellar"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/cellar/currying/code/partial/application/2017/02/04/currying-favor-with-partial-application-to-get-java-script-sql.html" hidden></a>
</article>
</p>
          </section>

          <!-- Footer -->
            <footer>
              <ul class="actions">
                <li><a href="https://luddites.me/cellar/" class="button">Home</a></li>
                <li><a href="https://luddites.me/cellar/blog/" class="button">Blog</a></li>
              </ul>
            </footer>
          </div>

        <!-- Footer -->
        <!-- Copyright -->
<div id="copyright">
  <ul>
    <li>
      <a href="https://github.com/crfroehlich" class="icon fa-github" rel="nofollow"><span class="label">GitHub</span></a> |
      <a href="https://twitter.com/tquestingbeast" class="icon fa-twitter" rel="nofollow"><span class="label">Twitter</span></a> |
      <a href="https://orcid.org/0000-0001-6652-5940" class="ai ai-orcid" rel="nofollow"><span class="label">ORCID</span></a> |
      <a href="https://scholar.google.es/citations?user=j3---DAAAAAJ" class="ai ai-google-scholar" rel="nofollow"><span class="label">Google Scholar</span></a> |
      
      <a href="/cellar/atom.xml" title="Atom Feed" class="icon fa-rss" rel="nofollow">
        <span class="label">Subscribe</span>
      </a>
      
    </li>
    <li>Powered by <a href="https://fastpages.fast.ai/">fastpages</a></li>
    <li>Design by <a href="https://html5up.net" rel="nofollow">HTML5 UP</a> &
      <a href="https://github.com/mmistakes/jekyll-theme-basically-basic">Basically Basic</a></li>
    <li>Jekyll Integration by <a href="https://jekyllup.com/">JekyllUp</a> </li>
    <li>Please take generously</li>
  </ul>
</div>


      </div>

    <!-- Scripts -->
    <!-- DYN -->
<script src="https://luddites.me/cellar/assets/js/jquery.min.js"></script>
<script src="https://luddites.me/cellar/assets/js/jquery.scrollex.min.js"></script>
<script src="https://luddites.me/cellar/assets/js/jquery.scrolly.min.js"></script>
<script src="https://luddites.me/cellar/assets/js/skel.min.js"></script>
<script src="https://luddites.me/cellar/assets/js/util.js"></script>
<script src="https://luddites.me/cellar/assets/js/main.js"></script>


  </body>
</html>
