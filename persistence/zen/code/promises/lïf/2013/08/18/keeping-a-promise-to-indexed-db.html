<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Keeping a Promise to IndexedDb | luddites, inc.</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Keeping a Promise to IndexedDb" />
<meta name="author" content="CF" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="APIs are hellish things inconstant moons inconsistent interfaces intolerable incompatibility If you …" />
<meta property="og:description" content="APIs are hellish things inconstant moons inconsistent interfaces intolerable incompatibility If you …" />
<link rel="canonical" href="https://crfroehlich.github.io/cellar/persistence/zen/code/promises/l%C3%AFf/2013/08/18/keeping-a-promise-to-indexed-db.html" />
<meta property="og:url" content="https://crfroehlich.github.io/cellar/persistence/zen/code/promises/l%C3%AFf/2013/08/18/keeping-a-promise-to-indexed-db.html" />
<meta property="og:site_name" content="luddites, inc." />
<meta property="og:image" content="https://crfroehlich.github.io/cellar/images/2013-08-18-keeping-a-promise-to-indexed-db.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2013-08-18T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://crfroehlich.github.io/cellar/persistence/zen/code/promises/l%C3%AFf/2013/08/18/keeping-a-promise-to-indexed-db.html","@type":"BlogPosting","headline":"Keeping a Promise to IndexedDb","dateModified":"2013-08-18T00:00:00-05:00","datePublished":"2013-08-18T00:00:00-05:00","author":{"@type":"Person","name":"CF"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://crfroehlich.github.io/cellar/persistence/zen/code/promises/l%C3%AFf/2013/08/18/keeping-a-promise-to-indexed-db.html"},"image":"https://crfroehlich.github.io/cellar/images/2013-08-18-keeping-a-promise-to-indexed-db.jpg","description":"APIs are hellish things inconstant moons inconsistent interfaces intolerable incompatibility If you …","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/cellar/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://crfroehlich.github.io/cellar/feed.xml" title="luddites, inc." /><link rel="shortcut icon" type="image/x-icon" href="/cellar/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/18.0.2/primer.css" integrity="sha512-HVfa+cjfwkQUvXjErrmQPOvNzlo4Ay3Dt8qCVYGu46DNiBmuQ8dWuT4Vl6/Y0t8oRjxl/bFLuuPpJ+ar8MXbAw==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" /><script src="https://hypothes.is/embed.js" async></script>

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/cellar/">luddites, inc.</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/cellar/about/">About Me</a><a class="page-link" href="/cellar/search/">Search</a><a class="page-link" href="/cellar/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Keeping a Promise to IndexedDb</h1><p class="page-description">APIs are hellish things inconstant moons inconsistent interfaces intolerable incompatibility If you ...</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2013-08-18T00:00:00-05:00" itemprop="datePublished">
        Aug 18, 2013
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">CF</span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      3 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/cellar/categories/#persistence">persistence</a>
        &nbsp;
      
        <a class="category-tags-link" href="/cellar/categories/#zen">zen</a>
        &nbsp;
      
        <a class="category-tags-link" href="/cellar/categories/#code">code</a>
        &nbsp;
      
        <a class="category-tags-link" href="/cellar/categories/#promises">promises</a>
        &nbsp;
      
        <a class="category-tags-link" href="/cellar/categories/#lïf">lïf</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
</ul><p>APIs are hellish things: inconstant moons, inconsistent interfaces, intolerable incompatibility. If you have not watched <a href="http://worrydream.com/dbx">Bret Victor’s latest epic</a>, I do recommend it. As he channels the spirit of innovation from the 1970s, he notes that it would be horrible if, 40 years from then, the only way two systems could communicate were through predefined and agreed upon interfaces. Indeed. What a terrible thing that would be it is.</p>

<p>As I continue to build out my prototype for <a href="https://github.com/somecallmechief/oj-qdb">OJ’s qDb</a> component (trying to fulfill <a href="http://hiking.luddites.me/2013/06/a-promise-to-indexeddb.html">my promise to IndexedDb</a>), I have done a few of the obvious things. I automated the database connection in the constructor as <a href="http://plus.google.com/115052908021360451116">+Kyaw Tun</a> recommended. I looked at <a href="http://plus.google.com/108530078008635144092">+Taylor Buley</a>’s own <a href="https://github.com/editor/indb">library</a> and make some tweaks accordingly. I have tested inserting up to a million records and selecting from the resulting object stores. There are some memory leaks to address and a few other performance issues before I’d recommend qDb on very, very large datasets–but it is in an OK state.</p>

<p>Yet, as pleased as I am with the abstraction layer that I built, I feel a growing sense of frustration in this class of problem solving.</p>

<p><strong>First</strong>, as OJ has grown, it has become unwieldy. I finally decided to begin chunking it out into separate projects, which can each have their own test suites. They can be fully independent and therefore fully modular from OJ’s point of view. Currently, I have:</p>

<ul>
  <li>
<a href="https://github.com/somecallmechief/oj">OJ</a>
    <ul>
      <li><a href="https://github.com/somecallmechief/oj-namespace">OJ-NameSpace</a></li>
      <li><a href="https://github.com/somecallmechief/oj-qdb">OJ-qDb</a></li>
      <li><a href="https://github.com/somecallmechief/oj-sql">OJ-SQL</a></li>
    </ul>
  </li>
</ul>

<p>This is nice. I can register each of these as NPM packages and list them as dependencies of OJ in its NPM config. The projects get versioned independently, greater decoupling them. And there was much rejoicing.</p>

<p><strong>Second</strong>, as OJ has grown, it has become more tightly coupled internally. I personally detest the module pattern introduced in ES6, and I have never liked RequireJs or CommonJs’s module patterns. That is a rant for another day. I do very much like the idea of defining all dependencies of a class up front, and fortunately it is easy to do both that and to use the namespace pattern (which I far prefer), by using Promises to solve the dependency management.</p>

<p>I have wanted to blog directly at this feature, but I felt I needed to start at the beginning. I think <a href="http://gruntjs.com/">Grunt</a> is a critical, essential tool of the language and Grunt is necessary to solve this problem. I began <a href="http://hiking.luddites.me/2013/07/making-sense-of-grunt-importing.html">introducing a part of my own migration to Grunt</a> and the <a href="http://hiking.luddites.me/2013/07/api-documentation-considered-evil.html">churn required to get your own documentation generated from code</a>. I intend to follow this through my own namespacing pattern, into Promises and out to utopia. Not today.</p>

<p><strong>Third</strong>, as I have developed interfaces with more and more tools, I am increasingly aware of the fragility and incompatibility of the technologies we develop. Even between my own <a href="http://hiking.luddites.me/2013/03/currying-favor-with-partial-application.html">raw, JavaScript object SQL library</a> and my own IndexedDb abstraction, the two have completely different interfaces. I have been refactoring my <a href="http://fogbugz.stackexchange.com/questions/7350/implementing-bugzilla-style-quips-using-fogbugz-plugin-architecture">Quips</a> <a href="https://github.com/somecallmechief/quips">plugin</a> to use <a href="https://www.firebase.com/">Firebase</a>, whose database API is completely different than anything I have already written (that’s not a complaint, Firebase is very awesome and looks quite promising).</p>

<p>Neither anticipated the other. And that is a sin. A sin with a capital <em>In</em>.</p>

<p>Bret Victor notes that if two systems cannot learn how to communicate with each other (without so called “API”s) that they cannot scale or survive. I think there is wisdom in this observation, and I think part of the answer is right in front of us.</p>

<p>A Promise is an agreement to try to do one thing. That thing can only succeed or fail (and potentially never do either). We know how to communicate Promises–within JavaScript, <a href="https://github.com/kriskowal/q">Q</a> does a marvelous job transmogrifying loosely compliant promises into a standardized promises. Across languages, services, applications, architectures–we should think about agreeing upon, if nothing else, what it means to be a Promise and whether we agree to support it.</p>

<p>It is not a complete solution to the challenge of connecting interfaces, but I promise it would help.</p>

  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="crfroehlich/cellar"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><div id="disqus_thread"></div>
<script>
  var disqus_config = function () {
    this.page.url = 'https://crfroehlich.github.io/cellar/persistence/zen/code/promises/l%C3%AFf/2013/08/18/keeping-a-promise-to-indexed-db.html';
    this.page.identifier = 'https://crfroehlich.github.io/cellar/persistence/zen/code/promises/l%C3%AFf/2013/08/18/keeping-a-promise-to-indexed-db.html';
  };

  (function () {
    var d = document, s = d.createElement('script');

    s.src = 'https://luddites.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments
    powered by Disqus.</a></noscript><a class="u-url" href="/cellar/persistence/zen/code/promises/l%C3%AFf/2013/08/18/keeping-a-promise-to-indexed-db.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/cellar/%20/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/cellar/feed.xml">
            <svg class="svg-icon blue">
              <use xlink:href="/cellar/assets/minima-social-icons.svg#rss"></use>
            </svg><span>rss</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>A journey of one person hiking their desk</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/crfroehlich" title="crfroehlich"><svg class="svg-icon grey"><use xlink:href="/cellar/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://www.linkedin.com/in/crfroehlich" title="crfroehlich"><svg class="svg-icon grey"><use xlink:href="/cellar/assets/minima-social-icons.svg#linkedin"></use></svg></a></li><li><a rel="me" href="https://twitter.com/tquestingbeast" title="tquestingbeast"><svg class="svg-icon grey"><use xlink:href="/cellar/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer></body>

</html>
